alter table project_stage_history engine=InnoDB;

create table project_assignment (ID int not null auto_increment, MOVEMENT_HISTORY_ID int not null, ASSIGNED_TO int not null, ASSIGNED_BY int not null, STATUS enum('notAttempted', 'incomplete', 'doneExceptInventory') not null default 'notAttempted', EXECUTIVE_REMARK text null default null, CREATION_TIME timestamp not null default 0, UPDATION_TIME timestamp not null default current_timestamp on update current_timestamp, primary key (ID), foreign key (MOVEMENT_HISTORY_ID) references project_stage_history(HISTORY_ID), foreign key (ASSIGNED_TO) references proptiger_admin(ADMINID), foreign key (ASSIGNED_BY) references proptiger_admin(ADMINID));


create table proptiger_admin_city (ID int not null auto_increment, ADMIN_ID int not null, CITY_ID int not null, primary key (ID), foreign key (ADMIN_ID) references proptiger_admin(ADMINID), foreign key (CITY_ID) references city(CITY_ID));

alter table resi_project add column MOVEMENT_HISTORY_ID int null default null after REASON_UNLAUNCHED_UNITS, add foreign key (MOVEMENT_HISTORY_ID) references project_stage_history(HISTORY_ID);

update resi_project rp inner join (select PROJECT_ID, max(HISTORY_ID) HISTORY_ID from project_stage_history group by PROJECT_ID) t on rp.PROJECT_ID = t.PROJECT_Id set rp.MOVEMENT_HISTORY_ID = t.HISTORY_ID;

alter table project_stage_history add column PREV_HISTORY_ID int null default null;

alter table project_stage_history add foreign key (PREV_HISTORY_ID) references project_stage_history(HISTORY_ID);

alter table project_assignment modify EXECUTIVE_REMARK enum('callBackRequest','couldNotContact','contactNoNotAvailable','noSuchProject','languageBarrier', 'websiteNotFound', 'partialInfoOnCall', 'ringingButNoResponse') default null;
